class Game{static W=15;static H=32;static START_X=6;static START_Y=1;static DEFAULT_FALL_SPEED=30;constructor(e,t){this.x=e,this.y=t,this.field=new Array(Game.H),this.fallSpeed=Game.DEFAULT_FALL_SPEED,this.top=Game.H-1,this.score=0,this.combo=0,this.scoreElement=$("#score"),this.comboElement=$("#combo"),this.timerElement=$("#timer"),this.timeLimit=180,this.variablesForGameOver={isGameOver:!1,red:0};for(let e=0;e<Game.H;e++){this.field[e]=new Array;for(let t=0;t<Game.W;t++){let i=new Block(this.x+t*Block.L+2*t,this.y+e*Block.L+2*e,Pattern.NUM);e!=Game.H-1&&0!=t&&t!=Game.W-1||(i.setLit(!0),i.setIsLocked(!0)),this.field[e].push(i)}}this.activeMino=Mino.createMino(Game.START_X,Game.START_Y,!0,this),Object.seal(this)}getBlock(e,t){return this.field[e][t]}shift(e,t){if(e-t>0){let i=this.field[e-t],s=this.field[e];for(let e=1;e<Game.W-1;e++)s[e].clone(i[e])}else{console.log("i - d <= 0",e,t);let i=this.field[e];for(let e=1;e<Game.W-1;e++)i[e].setLit(!1),i[e].setIsLocked(!1)}}breakOut(){let e;for(e=Game.H-2;e>=this.top&&!this.field[e].every((e=>e.getLit()));e--);let t=e;for(e=t;e>=this.top&&!this.field[e].some((e=>!e.getLit()));e--);let i=t-e;if(0==i)return this.combo=0,void this.reloadCombo();for(let e=t;e>=this.top;e--)this.shift(e,i);this.top+=i,this.combo++,this.score+=this.combo*(Game.W-2)*i*100,this.reloadCombo(),this.reloadScore(),Background.BLOCK_DESTROY.play()}reloadScore(){this.scoreElement.text(this.score)}reloadCombo(){this.comboElement.text(this.combo)}reloadTimer(){this.timerElement.text(this.timeLimit)}gameOver(){textSize(50),fill(this.variablesForGameOver.red,0,0),this.variablesForGameOver.red++,text("Game Over",this.x+26,this.y+350);for(let e=0;e<Game.H;e++)this.field[e][0].draw();for(let e=0;e<Game.H;e++)this.field[e][Game.W-1].draw();for(let e=1;e<Game.W-1;e++)this.field[Game.H-1][e].draw()}draw(){if(!this.variablesForGameOver.isGameOver){for(let e=0;e<Game.H;e++)for(let t=0;t<Game.W;t++)this.field[e][t].draw();return frameCount%60==0&&(this.reloadTimer(),this.timeLimit--),this.timeLimit<0?(this.variablesForGameOver.isGameOver=!0,Background.pause(),void Background.GAMEOVER.play()):this.activeMino.isActive||(this.activeMino=Mino.createMino(Game.START_X,Game.START_Y,!0,this),null!==this.activeMino)?void this.activeMino.draw(this):(this.variablesForGameOver.isGameOver=!0,Background.pause(),void Background.GAMEOVER.play())}this.gameOver()}showField(){for(let e=0;e<Game.H;e++){let t=this.field[e].map((e=>Number(e.getLit())));console.log(t.toString())}}}