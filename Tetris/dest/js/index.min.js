const Tetris=require("./tetris.min.js"),Block=Tetris.Block,Pattern=Tetris.Pattern,Background=Tetris.Background,Mylib=Tetris.Mylib;class Minos{constructor(t){this.p=t,this.minos=[]}add(){var t=Mylib.rand(100,this.p.width-100),e=Mylib.rand(100,this.p.height-100),s=Mylib.rand(1,7)*Mylib.plusMinus(),l=Mylib.rand(1,7)*Mylib.plusMinus(),i=Mylib.rand(1,7)*Mylib.plusMinus(),o=Mylib.rand(0,Pattern.NUM);this.minos.push(new Mino(this.p,t,e,s,l,i,o))}draw(){for(let t=0;t<this.minos.length;t++)this.minos[t].draw()}}class Title{constructor(e,s,l){this.p=e,this.x=s,this.y=l;let i=new Array(69);[s,l]=[88,114];for(let t=0;t<8;t++)i[t]=new Block(e,s+(Block.L+2)*t,l,7);[s,l]=[66,180];for(let t=0;t<10;t++)i[t+8]=new Block(e,s+(Block.L+2)*t,l,7);i[18]=new Block(e,176,202,7),i[19]=new Block(e,176,224,7),i[20]=new Block(e,176,246,7),i[21]=new Block(e,154,268,7),i[22]=new Block(e,128,280.5,7),[s,l]=[436,114];for(let t=0;t<9;t++)i[t+23]=new Block(e,s,l+(Block.L+2)*t,7);i[32]=new Block(e,458,202,7),i[33]=new Block(e,480,213,7),i[34]=new Block(e,502,224,7),i[35]=new Block(e,502,224,7),[s,l]=[694,114];for(let t=0;t<4;t++)i[t+36]=new Block(e,s,l+(Block.L+2)*t,7);[s,l]=[772,114];for(let t=0;t<6;t++)i[t+40]=new Block(e,s,l+(Block.L+2)*t,7);i[46]=new Block(e,760,249.5,7),i[47]=new Block(e,741,273.5,7),i[48]=new Block(e,716,292.5,7),[s,l]=[1008,114];for(let t=0;t<7;t++)i[t+49]=new Block(e,s+(Block.L+2)*t,l,7);i[56]=new Block(e,1131,137.5,7),i[57]=new Block(e,1119,159.5,7),i[58]=new Block(e,1108,184.5,7),i[59]=new Block(e,1091,208.5,7),i[60]=new Block(e,1071,233.5,7),i[61]=new Block(e,1047,250.5,7),i[62]=new Block(e,1024,268.5,7),i[63]=new Block(e,999,278.5,7),i[64]=new Block(e,977,285.5,7),i[65]=new Block(e,1114,214.5,7),i[66]=new Block(e,1135,230.5,7),i[67]=new Block(e,1155,251.5,7),i[68]=new Block(e,1162,277.5,7),i[69]=new Block(e,1170,302.5,7),this.title=i;let t=0,o=setInterval(()=>{69<t?clearInterval(o):(this.title[t++].setLit(!0),t%4==0&&Background.BLOCK_DESTROY.play())},25)}draw(){for(let t=0;t<69;t++)this.title[t].draw()}}class _Block extends Block{constructor(t,e,s,l,i){super(t,e,s,l,i)}draw(t,e){this.p.image(Pattern.DESINGS[this.design],t,e,Block.L,Block.L)}}class Mino{constructor(e,s,l,t,i,o,n){this.p=e,this.x=s,this.y=l,this.a=0,this.dx=t,this.dy=i,this.da=o,this.shape=Pattern.SHAPES[n],this.blocks=new Array(4);for(let t=0;t<4;t++){var[c,r]=this.shape[t];this.blocks[t]=new _Block(e,s+(Block.L+2)*c,l+(Block.L+2)*r,n,!0)}}draw(){(this.x<0||this.p.width<this.x)&&(this.dx*=-1),(this.y<0||this.p.height<this.y)&&(this.dy*=-1),this.x+=this.dx,this.y+=this.dy,this.a+=this.da,this.p.push(),this.p.translate(this.x,this.y),this.p.rotate(this.a);for(let t=0;t<4;t++){var[e,s]=this.shape[t];this.blocks[t].draw((Block.L+2)*e,(Block.L+2)*s)}this.p.pop()}}let btn=document.getElementsByClassName("btn");setTimeout(()=>{btn[0].classList.add("apear")},2e3),setTimeout(()=>{btn[1].classList.add("apear")},2200);const sketch=t=>{let e,s;t.preload=()=>{Background.loadBGMS(t),Pattern.setDesign(t)},t.setup=()=>{t.createCanvas(1240,680),e=new Title(t,10,10),s=new Minos(t),t.angleMode(t.DEGREES),setTimeout(()=>{let t=0,e=setInterval(()=>{s.add(),35<++t&&clearInterval(e)},100)},1700)},t.draw=()=>{t.background(0),s.draw(),e.draw()}},title=new p5(sketch,"screen");